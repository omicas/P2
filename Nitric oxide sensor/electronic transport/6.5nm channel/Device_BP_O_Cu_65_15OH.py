# -*- coding: utf-8 -*-
# -------------------------------------------------------------
# Two-probe Configuration
# -------------------------------------------------------------

left_electrode = nlread("E_BP_Cu.nc")[0]
right_electrode = nlread("E_BP_Cu.nc")[0]

# -------------------------------------------------------------
# Central Region
# -------------------------------------------------------------

# Set up lattice
vector_a = [24.0, 0.0, 0.0]*Angstrom
vector_b = [0.0, 13.4504, 0.0]*Angstrom
vector_c = [0.0, 0.0, 82.549]*Angstrom
central_region_lattice = UnitCell(vector_a, vector_b, vector_c)

# Define elements
central_region_elements = [Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Copper, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus, Oxygen,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Hydrogen,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Oxygen, Hydrogen, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Oxygen, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Oxygen, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Hydrogen, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Oxygen, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Hydrogen, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Oxygen, Hydrogen,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Oxygen, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Oxygen, Hydrogen, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Oxygen, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Hydrogen, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Oxygen, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Hydrogen, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Oxygen, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Oxygen, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Hydrogen, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Oxygen, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus, Oxygen,
                           Hydrogen, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Oxygen, Hydrogen, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Oxygen, Hydrogen,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Oxygen, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Oxygen, Hydrogen, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Oxygen, Hydrogen, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Oxygen, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Hydrogen, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Copper, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus, Phosphorus,
                           Phosphorus, Phosphorus, Phosphorus, Phosphorus]

# Define coordinates
central_region_coordinates = [[  7.409560932528,   5.8506305553  ,   0.035679186379],
                              [  7.41398056104 ,   9.300225821137,   0.042690156156],
                              [  7.413308657664,   2.531353055833,   0.129340069448],
                              [  7.417120260432,  12.617714059704,   0.13349056136 ],
                              [  7.309328587728,   7.572992577103,   1.448038272622],
                              [  7.424332051968,   4.231801014969,   1.616830658058],
                              [  7.425833144208,  10.920115487321,   1.623275871809],
                              [  7.415805944808,   0.852808535847,   1.641398001049],
                              [  5.156754452136,   7.574293177909,   2.260656660499],
                              [  5.258566829136,   4.227134318578,   2.288115407059],
                              [  5.260767994632,  10.919348398554,   2.290471229176],
                              [  5.25490452156 ,   0.848320172647,   2.30607402341 ],
                              [  8.439015750096,   7.535659195777,   3.358269548138],
                              [  5.187102067968,   5.910614112811,   3.775628311106],
                              [  5.205008587152,   9.231470166703,   3.777250107308],
                              [  5.234437251432,   2.548626745887,   3.796086485   ],
                              [  5.238683992272,  12.598325360104,   3.798098508329],
                              [  7.3892393964  ,  12.602651021239,   4.492739409669],
                              [  7.383315735384,   2.544594403233,   4.494235455302],
                              [  7.326063331056,   9.158815824505,   4.626959521402],
                              [  7.305138841608,   5.975072338068,   4.641906609077],
                              [  7.371138817344,   0.848192441798,   5.989135187015],
                              [  7.386117603168,  10.947383993737,   6.031399557475],
                              [  7.37480013324 ,   4.194106075821,   6.041672339732],
                              [  7.214321461632,   7.574073604312,   6.209615234573],
                              [  5.201138514072,   0.84870255263 ,   6.643655167382],
                              [  5.196895494264,  10.925838138125,   6.670783588644],
                              [  5.186196648648,   4.221621189511,   6.679830095844],
                              [  5.033862955104,   7.5770551652  ,   6.783182879221],
                              [  5.17319329992 ,  12.624322782011,   8.155026548296],
                              [  5.170314759048,   2.517587599985,   8.159523985081],
                              [  5.1212195112  ,   9.299721042299,   8.240577445332],
                              [  5.119509698736,   5.855600138437,   8.243005044143],
                              [  7.195015138128,   9.247746775485,   8.60012386935 ],
                              [  7.190927966976,   5.870327973619,   8.600438035789],
                              [  7.154511532296,   2.509388230778,   8.60108532231 ],
                              [  7.156218382344,  12.610669806559,   8.60113055338 ],
                              [  7.169991521016,   7.559953394608,  10.094426003729],
                              [  7.162799434152,  10.930967710138,  10.098471176955],
                              [  7.158702218976,   4.189981971485,  10.099404978805],
                              [  7.155278289072,   0.835973050706,  10.105215176772],
                              [  8.88052999452 ,  10.897467399028,  10.190117888104],
                              [  5.020270767552,   7.562621941594,  10.778975860569],
                              [  5.011311880296,   4.192666856295,  10.790383536321],
                              [  5.016346064808,  10.928800433843,  10.791243949728],
                              [  5.010362097432,   0.835602016674,  10.811788618911],
                              [  9.12319317288 ,  11.240997143731,  11.076112795256],
                              [  5.062636146048,   5.883672544204,  12.286250695882],
                              [  5.066676836376,   9.237250744856,  12.288578383746],
                              [  5.049483673608,  12.599357384843,  12.308370957871],
                              [  5.04354361044 ,   2.521061776971,  12.308633874266],
                              [  7.238494596432,   5.837069900004,  12.913527831781],
                              [  7.243016189976,   9.286181689774,  12.919604278709],
                              [  7.217617210992,  12.609908241912,  12.952732203586],
                              [  7.211739418008,   2.514242067211,  12.95305615597 ],
                              [  8.929469978376,   2.480741756101,  13.044702867119],
                              [  9.172133156736,   2.824271500804,  13.930697774271],
                              [  7.060755103728,   7.558034707597,  14.360099381058],
                              [  7.228103709744,   0.837972432921,  14.457581912037],
                              [  7.240923428112,   4.1901912969  ,  14.460359862851],
                              [  7.244910616248,  10.936951337318,  14.462131094436],
                              [  5.083088086008,   0.835297021416,  15.163654531354],
                              [  5.09750786736 ,   4.210209301993,  15.170152762761],
                              [  5.10148304208 ,  10.914141441803,  15.170919800107],
                              [  4.986464688336,   7.562334675133,  15.207393112376],
                              [  8.145737626008,   7.540853955208,  15.428349266185],
                              [  5.08549190364 ,   2.518805971811,  16.660947951576],
                              [  5.088204711408,  12.601695780166,  16.662863105693],
                              [  5.169999831576,   9.248744069529,  16.683828289327],
                              [  5.165304320496,   5.873166638278,  16.683952688013],
                              [  7.31782245024 ,   5.853495872047,  17.3958797873  ],
                              [  7.321833961152,   9.264903024797,  17.396188789828],
                              [  7.217925672864,   2.520186730962,  17.401972619974],
                              [  7.221123066504,  12.600364794745,  17.402346995319],
                              [  7.258982697336,   7.559629407923,  18.886801449697],
                              [  7.168406885592,   0.836161537039,  18.893136036026],
                              [  7.166162681952,  10.930327332572,  18.911196939324],
                              [  7.16164692456 ,   4.191128688982,  18.911359049788],
                              [  8.88389324232 ,  10.896827021462,  19.002843650473],
                              [  5.081692339656,   7.56154859927 ,  19.513015018839],
                              [  5.001876514944,   0.835040169807,  19.544215288502],
                              [  5.003794238232,  10.924006639539,  19.548752741695],
                              [  4.999976978712,   4.196396267803,  19.549721342583],
                              [  9.12655642068 ,  11.240356766165,  19.888838557625],
                              [  5.0420206038  ,   5.893184313204,  21.031017399965],
                              [  5.04600388092 ,   9.22725936811 ,  21.031547890196],
                              [  4.998907679448,  12.605939705669,  21.051802871722],
                              [  4.997123316024,   2.511973956415,  21.052695609441],
                              [  7.195015138128,   9.247746775485,  21.722123869313],
                              [  7.190927966976,   5.870327973619,  21.722438035821],
                              [  7.154511532296,   2.509388230778,  21.723085322273],
                              [  7.156218382344,  12.610669806559,  21.723130553343],
                              [  7.169991521016,   7.559953394608,  23.216426003761],
                              [  7.162799434152,  10.930967710138,  23.220471176987],
                              [  7.158702218976,   4.189981971485,  23.221404978837],
                              [  7.155278289072,   0.835973050706,  23.227215176804],
                              [  8.876432779344,   4.156481660375,  23.313051689986],
                              [  5.020270767552,   7.562621941594,  23.900975860601],
                              [  5.011311880296,   4.192666856295,  23.912383536283],
                              [  5.016346064808,  10.928800433843,  23.91324394976 ],
                              [  5.010362097432,   0.835602016674,  23.933788618873],
                              [  9.119095957704,   4.500011405078,  24.199046597138],
                              [  5.062636146048,   5.883672544204,  25.408250695914],
                              [  5.066676836376,   9.237250744856,  25.410578383778],
                              [  5.049483673608,  12.599357384843,  25.430370957834],
                              [  5.04354361044 ,   2.521061776971,  25.430633874229],
                              [  7.238494596432,   5.837069900004,  26.035527831743],
                              [  7.243016189976,   9.286181689774,  26.041604278671],
                              [  7.217617210992,  12.609908241912,  26.074732203618],
                              [  7.211739418008,   2.514242067211,  26.075056156002],
                              [  8.960746750344,   9.252681378664,  26.13325098982 ],
                              [  9.203409928704,   9.596211123367,  27.019245896972],
                              [  7.060755103728,   7.558034707597,  27.48209938102 ],
                              [  7.228103709744,   0.837972432921,  27.579581912068],
                              [  7.240923428112,   4.1901912969  ,  27.582359862883],
                              [  7.244910616248,  10.936951337318,  27.584131094399],
                              [  5.083088086008,   0.835297021416,  28.285654531386],
                              [  5.09750786736 ,   4.210209301993,  28.292152762723],
                              [  5.10148304208 ,  10.914141441803,  28.292919800139],
                              [  4.986464688336,   7.562334675133,  28.329393112408],
                              [  8.145737626008,  10.903453955208,  28.550349266217],
                              [  5.08549190364 ,   2.518805971811,  29.782947951608],
                              [  5.088204711408,  12.601695780166,  29.784863105725],
                              [  5.169999831576,   9.248744069529,  29.805828289359],
                              [  5.165304320496,   5.873166638278,  29.805952688045],
                              [  7.31782245024 ,   5.853495872047,  30.517879787263],
                              [  7.321833961152,   9.264903024797,  30.51818878986 ],
                              [  7.217925672864,   2.520186730962,  30.523972619937],
                              [  7.221123066504,  12.600364794745,  30.524346995351],
                              [  8.935656233232,   2.486686419852,  30.615619331086],
                              [  9.178319411592,   2.830216164555,  31.501614238238],
                              [  7.258982697336,   7.559629407923,  32.008801449729],
                              [  7.168406885592,   0.836161537039,  32.015136035988],
                              [  7.166162681952,  10.930327332572,  32.033196939286],
                              [  7.16164692456 ,   4.191128688982,  32.03335904975 ],
                              [  8.976713257704,   7.526129096813,  32.100448160878],
                              [  5.081692339656,   7.56154859927 ,  32.635015018871],
                              [  5.001876514944,   0.835040169807,  32.666215288465],
                              [  5.003794238232,  10.924006639539,  32.670752741727],
                              [  4.999976978712,   4.196396267803,  32.671721342614],
                              [  9.219376436064,   7.869658841516,  32.98644306803 ],
                              [  5.0420206038  ,   5.893184313204,  34.153017399997],
                              [  5.04600388092 ,   9.22725936811 ,  34.153547890228],
                              [  4.998907679448,  12.605939705669,  34.173802871685],
                              [  4.997123316024,   2.511973956415,  34.174695609473],
                              [  7.195015138128,   9.247746775485,  34.844123869345],
                              [  7.190927966976,   5.870327973619,  34.844438035784],
                              [  7.154511532296,   2.509388230778,  34.845085322305],
                              [  7.156218382344,  12.610669806559,  34.845130553375],
                              [  7.169991521016,   7.559953394608,  36.338426003723],
                              [  7.162799434152,  10.930967710138,  36.342471176949],
                              [  7.158702218976,   4.189981971485,  36.343404978799],
                              [  7.155278289072,   0.835973050706,  36.349215176766],
                              [  8.88052999452 ,  10.897467399028,  36.434117888098],
                              [  5.020270767552,   7.562621941594,  37.022975860563],
                              [  5.011311880296,   4.192666856295,  37.034383536315],
                              [  5.016346064808,  10.928800433843,  37.035243949723],
                              [  5.010362097432,   0.835602016674,  37.055788618905],
                              [  9.12319317288 ,  11.240997143731,  37.32011279525 ],
                              [  5.062636146048,   5.883672544204,  38.530250695946],
                              [  5.066676836376,   9.237250744856,  38.53257838381 ],
                              [  5.049483673608,  12.599357384843,  38.552370957866],
                              [  5.04354361044 ,   2.521061776971,  38.552633874261],
                              [  7.238494596432,   5.837069900004,  39.157527831775],
                              [  7.243016189976,   9.286181689774,  39.163604278703],
                              [  7.217617210992,  12.609908241912,  39.19673220365 ],
                              [  7.211739418008,   2.514242067211,  39.197056155965],
                              [  7.060755103728,   7.558034707597,  40.604099381052],
                              [  7.228103709744,   0.837972432921,  40.701581912031],
                              [  7.240923428112,   4.1901912969  ,  40.704359862846],
                              [  7.244910616248,  10.936951337318,  40.706131094431],
                              [  5.083088086008,   0.835297021416,  41.407654531348],
                              [  5.09750786736 ,   4.210209301993,  41.414152762755],
                              [  5.10148304208 ,  10.914141441803,  41.414919800102],
                              [  4.986464688336,   7.562334675133,  41.451393112439],
                              [  8.145737626008,   4.178253955208,  41.672349266179],
                              [  5.08549190364 ,   2.518805971811,  42.90494795164 ],
                              [  5.088204711408,  12.601695780166,  42.906863105757],
                              [  5.169999831576,   9.248744069529,  42.927828289391],
                              [  5.165304320496,   5.873166638278,  42.927952688007],
                              [  7.31782245024 ,   5.853495872047,  43.639879787295],
                              [  7.321833961152,   9.264903024797,  43.640188789823],
                              [  7.217925672864,   2.520186730962,  43.645972619968],
                              [  7.221123066504,  12.600364794745,  43.646346995313],
                              [  7.258982697336,   7.559629407923,  45.130801449692],
                              [  7.168406885592,   0.836161537039,  45.13713603602 ],
                              [  7.166162681952,  10.930327332572,  45.155196939318],
                              [  7.16164692456 ,   4.191128688982,  45.155359049782],
                              [  8.976713257704,   7.526129096813,  45.222448160841],
                              [  5.081692339656,   7.56154859927 ,  45.757015018902],
                              [  5.001876514944,   0.835040169807,  45.788215288497],
                              [  5.003794238232,  10.924006639539,  45.792752741759],
                              [  4.999976978712,   4.196396267803,  45.793721342577],
                              [  9.219376436064,   7.869658841516,  46.108443067993],
                              [  5.0420206038  ,   5.893184313204,  47.27501739996 ],
                              [  5.04600388092 ,   9.22725936811 ,  47.27554789026 ],
                              [  4.998907679448,  12.605939705669,  47.295802871717],
                              [  4.997123316024,   2.511973956415,  47.296695609436],
                              [  7.238494596432,   5.837069900004,  47.817850340995],
                              [  7.243016189976,   9.286181689774,  47.823926787923],
                              [  7.217617210992,  12.609908241912,  47.85705471287 ],
                              [  7.211739418008,   2.514242067211,  47.857378665254],
                              [  7.060755103728,   7.558034707597,  49.264421890272],
                              [  7.228103709744,   0.837972432921,  49.36190442132 ],
                              [  7.240923428112,   4.1901912969  ,  49.364682372066],
                              [  7.244910616248,  10.936951337318,  49.366453603651],
                              [  5.083088086008,   0.835297021416,  50.067977040638],
                              [  5.09750786736 ,   4.210209301993,  50.074475271975],
                              [  5.10148304208 ,  10.914141441803,  50.075242309391],
                              [  4.986464688336,   7.562334675133,  50.111715621659],
                              [  8.145737626008,   7.540853955208,  50.332671775399],
                              [  5.08549190364 ,   2.518805971811,  51.56527046086 ],
                              [  5.088204711408,  12.601695780166,  51.567185614977],
                              [  5.169999831576,   9.248744069529,  51.588150798611],
                              [  5.165304320496,   5.873166638278,  51.588275197227],
                              [  7.31782245024 ,   5.853495872047,  52.300202296515],
                              [  7.321833961152,   9.264903024797,  52.300511299043],
                              [  7.217925672864,   2.520186730962,  52.306295129188],
                              [  7.221123066504,  12.600364794745,  52.306669504533],
                              [  8.935656233232,   2.486686419852,  52.397941840337],
                              [  9.178319411592,   2.830216164555,  53.283936747489],
                              [  7.258982697336,   7.559629407923,  53.791123958912],
                              [  7.168406885592,   0.836161537039,  53.79745854524 ],
                              [  7.166162681952,  10.930327332572,  53.815519448538],
                              [  7.16164692456 ,   4.191128688982,  53.815681559002],
                              [  5.081692339656,   7.56154859927 ,  54.417337528122],
                              [  5.001876514944,   0.835040169807,  54.448537797717],
                              [  5.003794238232,  10.924006639539,  54.453075250979],
                              [  4.999976978712,   4.196396267803,  54.454043851797],
                              [  5.0420206038  ,   5.893184313204,  55.93533990918 ],
                              [  5.04600388092 ,   9.22725936811 ,  55.93587039948 ],
                              [  4.998907679448,  12.605939705669,  55.956125380937],
                              [  4.997123316024,   2.511973956415,  55.957018118725],
                              [  7.195015138128,   9.247746775485,  56.626446378596],
                              [  7.190927966976,   5.870327973619,  56.626760545036],
                              [  7.154511532296,   2.509388230778,  56.627407831557],
                              [  7.156218382344,  12.610669806559,  56.627453062627],
                              [  8.908658527344,   5.836827662509,  56.718407256185],
                              [  9.151321705704,   6.180357407212,  57.604402163337],
                              [  7.169991521016,   7.559953394608,  58.120748512975],
                              [  7.162799434152,  10.930967710138,  58.124793686201],
                              [  7.158702218976,   4.189981971485,  58.125727488051],
                              [  7.155278289072,   0.835973050706,  58.131537686018],
                              [  5.081692339656,   7.56154859927 ,  58.879015018902],
                              [  5.001876514944,   0.835040169807,  58.910215288497],
                              [  5.003794238232,  10.924006639539,  58.914752741759],
                              [  4.999976978712,   4.196396267803,  58.915721342577],
                              [  5.0420206038  ,   5.893184313204,  60.39701739996 ],
                              [  5.04600388092 ,   9.22725936811 ,  60.39754789026 ],
                              [  4.998907679448,  12.605939705669,  60.417802871717],
                              [  4.997123316024,   2.511973956415,  60.418695609436],
                              [  7.238494596432,   5.837069900004,  60.939850340995],
                              [  7.243016189976,   9.286181689774,  60.945926787923],
                              [  7.217617210992,  12.609908241912,  60.97905471287 ],
                              [  7.211739418008,   2.514242067211,  60.979378665254],
                              [  8.960746750344,   9.252681378664,  61.037573499072],
                              [  9.203409928704,   9.596211123367,  61.923568406224],
                              [  7.060755103728,   7.558034707597,  62.386421890272],
                              [  7.228103709744,   0.837972432921,  62.48390442132 ],
                              [  7.240923428112,   4.1901912969  ,  62.486682372066],
                              [  7.244910616248,  10.936951337318,  62.488453603651],
                              [  5.083088086008,   0.835297021416,  63.189977040638],
                              [  5.09750786736 ,   4.210209301993,  63.196475271975],
                              [  5.10148304208 ,  10.914141441803,  63.197242309391],
                              [  4.986464688336,   7.562334675133,  63.233715621659],
                              [  8.145737626008,   0.815653955208,  63.454671775399],
                              [  5.08549190364 ,   2.518805971811,  64.68727046086 ],
                              [  5.088204711408,  12.601695780166,  64.689185614977],
                              [  5.169999831576,   9.248744069529,  64.710150798611],
                              [  5.165304320496,   5.873166638278,  64.710275197227],
                              [  7.31782245024 ,   5.853495872047,  65.422202296515],
                              [  7.321833961152,   9.264903024797,  65.422511299043],
                              [  7.217925672864,   2.520186730962,  65.428295129188],
                              [  7.221123066504,  12.600364794745,  65.428669504533],
                              [  9.035553010608,   5.819995560937,  65.513849007664],
                              [  9.278216188968,   6.16352530564 ,  66.399843914816],
                              [  7.258982697336,   7.559629407923,  66.913123958912],
                              [  7.168406885592,   0.836161537039,  66.91945854524 ],
                              [  7.166162681952,  10.930327332572,  66.937519448538],
                              [  7.16164692456 ,   4.191128688982,  66.937681559002],
                              [  5.081692339656,   7.56154859927 ,  67.539337528122],
                              [  5.001876514944,   0.835040169807,  67.570537797717],
                              [  5.003794238232,  10.924006639539,  67.575075250979],
                              [  4.999976978712,   4.196396267803,  67.576043851797],
                              [  5.0420206038  ,   5.893184313204,  69.05733990918 ],
                              [  5.04600388092 ,   9.22725936811 ,  69.05787039948 ],
                              [  4.998907679448,  12.605939705669,  69.078125380937],
                              [  4.997123316024,   2.511973956415,  69.079018118725],
                              [  7.195015138128,   9.247746775485,  69.748446378596],
                              [  7.190927966976,   5.870327973619,  69.748760545036],
                              [  7.154511532296,   2.509388230778,  69.749407831557],
                              [  7.156218382344,  12.610669806559,  69.749453062627],
                              [  8.912745698496,   9.214246464375,  69.840093089745],
                              [  9.155408876856,   9.557776209078,  70.726087996897],
                              [  7.169991521016,   7.559953394608,  71.242748512975],
                              [  7.162799434152,  10.930967710138,  71.246793686201],
                              [  7.158702218976,   4.189981971485,  71.247727488051],
                              [  7.155278289072,   0.835973050706,  71.253537686018],
                              [  8.87300884944 ,   0.802472739596,  71.345184397167],
                              [  5.020270767552,   7.562621941594,  71.927298369815],
                              [  5.011311880296,   4.192666856295,  71.938706045567],
                              [  5.016346064808,  10.928800433843,  71.939566458974],
                              [  5.010362097432,   0.835602016674,  71.960111128157],
                              [  9.1156720278  ,   1.146002484299,  72.231179304319],
                              [  5.062636146048,   5.883672544204,  73.434573205129],
                              [  5.066676836376,   9.237250744856,  73.436900892993],
                              [  5.049483673608,  12.599357384843,  73.456693467118],
                              [  5.04354361044 ,   2.521061776971,  73.456956383513],
                              [  7.409560932528,   5.8506305553  ,  74.306001695657],
                              [  7.41398056104 ,   9.300225821137,  74.313012665434],
                              [  7.413308657664,   2.531353055833,  74.399662578726],
                              [  7.417120260432,  12.617714059704,  74.403813070569],
                              [  7.309328587728,   7.572992577103,  75.7183607819  ],
                              [  7.424332051968,   4.231801014969,  75.887153167336],
                              [  7.425833144208,  10.920115487321,  75.893598381018],
                              [  7.415805944808,   0.852808535847,  75.911720510327],
                              [  5.156754452136,   7.574293177909,  76.530979169708],
                              [  5.258566829136,   4.227134318578,  76.558437916338],
                              [  5.260767994632,  10.919348398554,  76.560793738385],
                              [  5.25490452156 ,   0.848320172647,  76.576396532688],
                              [  8.439015750096,   7.535659195777,  77.628592057417],
                              [  5.187102067968,   5.910614112811,  78.045950820385],
                              [  5.205008587152,   9.231470166703,  78.047572616517],
                              [  5.234437251432,   2.548626745887,  78.066408994278],
                              [  5.238683992272,  12.598325360104,  78.068421017607],
                              [  7.3892393964  ,  12.602651021239,  78.763061918947],
                              [  7.383315735384,   2.544594403233,  78.764557964581],
                              [  7.326063331056,   9.158815824505,  78.897282030681],
                              [  7.305138841608,   5.975072338068,  78.912229118355],
                              [  7.371138817344,   0.848192441798,  80.259457696294],
                              [  7.386117603168,  10.947383993737,  80.301722066753],
                              [  7.37480013324 ,   4.194106075821,  80.31199484901 ],
                              [  7.214321461632,   7.574073604312,  80.479937743782],
                              [  5.201138514072,   0.84870255263 ,  80.91397767659 ],
                              [  5.196895494264,  10.925838138125,  80.941106097922],
                              [  5.186196648648,   4.221621189511,  80.950152605122],
                              [  5.033862955104,   7.5770551652  ,  81.053505388499],
                              [  5.17319329992 ,  12.624322782011,  82.425349057574],
                              [  5.170314759048,   2.517587599985,  82.42984649436 ],
                              [  5.1212195112  ,   9.299721042299,  82.51089995461 ],
                              [  5.119509698736,   5.855600138437,  82.513327553421]]*Angstrom

# Set up configuration
central_region = BulkConfiguration(
    bravais_lattice=central_region_lattice,
    elements=central_region_elements,
    cartesian_coordinates=central_region_coordinates
    )

#VG=numpy.linspace(0.0,2.0,5)
VG=[-0.5]
for vg in VG:
  # Add metallic region
  metallic_region_0 = BoxRegion(
    vg*Volt,
    xmin = 0.0*Angstrom, xmax = 0.5*Angstrom,
    ymin = 0.0*Angstrom, ymax = 13.4504*Angstrom,
    zmin = 8.33124080877*Angstrom, zmax = 74.0*Angstrom,
  )

  metallic_regions = [metallic_region_0]
  central_region.setMetallicRegions(metallic_regions)

  # Add dielectric region
  dielectric_region_0 = BoxRegion(
    3.9,
    xmin = 0.5*Angstrom, xmax = 4.0*Angstrom,
    ymin = 0.0*Angstrom, ymax = 13.4504*Angstrom,
    zmin = 8.33124080877*Angstrom, zmax = 74.0*Angstrom,
  )

  dielectric_regions = [dielectric_region_0]
  central_region.setDielectricRegions(dielectric_regions)

  device_configuration = DeviceConfiguration(
    central_region,
    [left_electrode, right_electrode]
    )

# -------------------------------------------------------------
# Calculator
# -------------------------------------------------------------
#----------------------------------------
# Basis Set
#----------------------------------------
  basis_set = [
    GGABasis.Oxygen_DoubleZetaPolarized,
    GGABasis.Hydrogen_DoubleZetaPolarized,
    GGABasis.Phosphorus_DoubleZetaPolarized,
    GGABasis.Copper_DoubleZetaPolarized,
    ]

#----------------------------------------
# Exchange-Correlation
#----------------------------------------
  exchange_correlation = GGA.PBE

#----------------------------------------
# Numerical Accuracy Settings
#----------------------------------------
  device_k_point_sampling = MonkhorstPackGrid(
    nb=3,
    nc=32,
    )
  device_numerical_accuracy_parameters = NumericalAccuracyParameters(
    k_point_sampling=device_k_point_sampling,
    )

#----------------------------------------
# Iteration Control Settings
#----------------------------------------
  device_iteration_control_parameters = IterationControlParameters(
    max_steps=300,
    tolerance=5e-05,
    number_of_history_steps=30,
    )

#----------------------------------------
# Device Algorithm Settings
#----------------------------------------
  initial_density_type = NeutralAtom(
    electrode_constraint_length=8.27868*Angstrom,
    )

  device_algorithm_parameters = DeviceAlgorithmParameters(
    initial_density_type=initial_density_type,
    )

#----------------------------------------
# Device Calculator
#----------------------------------------
  calculator = DeviceLCAOCalculator(
    basis_set=basis_set,
    exchange_correlation=exchange_correlation,
    numerical_accuracy_parameters=device_numerical_accuracy_parameters,
    iteration_control_parameters=device_iteration_control_parameters,
    device_algorithm_parameters=device_algorithm_parameters,
#    electrode_calculators=
#        [left_electrode_calculator, right_electrode_calculator],
    )

  device_configuration.setCalculator(calculator)
  device_configuration.update()
  nlsave('Device_BP_O_Cu_65_15OH_%s.nc'%vg, device_configuration)

# -------------------------------------------------------------
# Transmission Spectrum
# -------------------------------------------------------------
  kpoint_grid = MonkhorstPackGrid()

  transmission_spectrum = TransmissionSpectrum(
    configuration=device_configuration,
    energies=numpy.linspace(-1,1,101)*eV,
    kpoints=kpoint_grid,
    energy_zero_parameter=AverageFermiLevel,
    infinitesimal=1e-06*eV,
    self_energy_calculator=RecursionSelfEnergy(),
    )
  nlsave('Device_BP_O_Cu_65_15OH_%s.nc'%vg, transmission_spectrum)
  nlprint(transmission_spectrum)

  T=[300]
#  T=numpy.linspace(250,350,11)
  for temp in T:
    temperature=temp*Kelvin
    conductance=transmission_spectrum.conductance(electrode_temperatures=(temperature,temperature))
    current=transmission_spectrum.current(electrode_temperatures=(temperature,temperature))
    if ( processIsMaster() ):
      print "Gate voltage = %s: Conductance = %s at T = %s"%(vg,conductance,temperature)
      print "Gate voltage = %s: Current = %s at T = %s"%(vg,current,temperature)

# # -------------------------------------------------------------
# # IV Curve
# # -------------------------------------------------------------
#   biases = [0.000000, 0.200000, 0.400000, 0.600000, 0.800000, 1.000000,
#           1.200000, 1.400000, 1.600000, 1.800000, 2.000000]*Volt

#   kpoint_grid = MonkhorstPackGrid()

#   iv_curve = IVCurve(
#     configuration=device_configuration,
#     biases=biases,
#     energies=numpy.linspace(-1,1,101)*eV,
#     kpoints=kpoint_grid,
#     self_energy_calculator=RecursionSelfEnergy(),
#     energy_zero_parameter=AverageFermiLevel,
#     infinitesimal=1e-06*eV,
#     selfconsistent_configurations_filename_prefix=NoCheckpointHandler,
#     log_filename_prefix=None
#     )
#   nlsave('Device_BP_O_Cu_65_15OH_%s.nc'%vg, iv_curve)
#   nlprint(iv_curve)

#   biases = [-0.200000, -0.400000, -0.600000, -0.800000, -1.000000,
#           -1.200000, -1.400000, -1.600000, -1.800000, -2.000000]*Volt

#   kpoint_grid = MonkhorstPackGrid()

#   iv_curve = IVCurve(
#     configuration=device_configuration,
#     biases=biases,
#     energies=numpy.linspace(-1,1,101)*eV,
#     kpoints=kpoint_grid,
#     self_energy_calculator=RecursionSelfEnergy(),
#     energy_zero_parameter=AverageFermiLevel,
#     infinitesimal=1e-06*eV,
#     selfconsistent_configurations_filename_prefix=NoCheckpointHandler,
#     log_filename_prefix=None
#     )
#   nlsave('Device_BP_O_Cu_65_15OH_%s.nc'%vg, iv_curve)
#   nlprint(iv_curve)
